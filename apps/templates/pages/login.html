{% extends 'layouts/base.html' %}

{% block title %}Portal de Clientes - Iniciar Sesión{% endblock title %}

{% block preloader %}
{% include 'partials/preloader.html' %}
{% endblock preloader %}

{% block icon %}
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="180x180" href="{{ config.ASSETS_ROOT }}/favicon_io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="{{ config.ASSETS_ROOT }}/favicon_io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="{{ config.ASSETS_ROOT }}/favicon_io/favicon-16x16.png">
<link rel="manifest" href="{{ config.ASSETS_ROOT }}/favicon_io/site.webmanifest">
<link rel="shortcut icon" href="{{ config.ASSETS_ROOT }}/favicon_io/favicon.ico" type="image/x-icon">
{% endblock icon %}

{% block body_attribute %}class="body2 body"{% endblock body_attribute %}

{% block content %}

<!--=====log in area start=======-->
<div class="log-in-area sp _relative">
  <div class="container">
    <div class="row">
      <div class="col-lg-6 m-auto text-center">
        <div class="main-logo">
          <a href="/"><img
            src="{{ config.ASSETS_ROOT }}/img/logo/svgMAIN-intelalogo.svg" alt="Arsys Intela" style="width: 280px; height: auto;"></a>
        </div>
      </div>
    </div>
    <div class="space50"></div>
    <div class="row align-items-center">
      <div class="col-lg-6">
        <div class="login-form" style="margin-top: -20px;">
          <div class="headding">
            <h2>Portal de Clientes</h2>
            <p>Ingresa tus credenciales para acceder al portal.</p>
          </div>

          {% if error %}
          <div class="alert alert-danger" style="background-color: #f8d7da; color: #721c24; padding: 12px; border-radius: 4px; margin-bottom: 20px; border: 1px solid #f5c6cb;">
            <strong>Error:</strong> {{ error }}
          </div>
          {% endif %}

          <form method="POST" action="/login" class="inputs" id="loginForm">
            <div class="single-inputs">
              <label>Correo Electrónico</label>
              <input type="email" name="email" placeholder="Ingresa tu correo electrónico" required>
            </div>
            <div class="single-inputs">
              <label>Contraseña</label>
              <input type="password" name="password" placeholder="Ingresa tu contraseña" required>
            </div>
            <input type="hidden" name="g-recaptcha-response" id="g-recaptcha-response">
            <div class="button">
              <button type="submit" class="theme-btn2" id="loginSubmitBtn">Iniciar Sesión</button>
            </div>
          </form>

          <div class="forgot-text">
            <p><a href="/">Volver al inicio</a></p>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="login-img">
          <img src="{{ config.ASSETS_ROOT }}/img/others/login-page-img.png" alt="">
        </div>
      </div>
    </div>
  </div>
  <img class="shape1" src="{{ config.ASSETS_ROOT }}/img/shapes/apps-shape1.png" alt="">
  <img class="shape2" src="{{ config.ASSETS_ROOT }}/img/shapes/apps-shape1.png" alt="">
</div>
<!--=====log in area end=======-->

{% endblock content %}

{% block extra_javascript %}
{% if config.RECAPTCHA_SITE_KEY %}
<!-- Google reCAPTCHA v3 -->
<script src="https://www.google.com/recaptcha/api.js?render={{ config.RECAPTCHA_SITE_KEY }}"></script>
<script>
(function() {
  'use strict';
  
  const siteKey = '{{ config.RECAPTCHA_SITE_KEY }}';
  
  if (!siteKey) {
    console.warn('reCAPTCHA SITE_KEY no configurada');
    return;
  }
  
  const loginForm = document.getElementById('loginForm');
  const submitBtn = document.getElementById('loginSubmitBtn');
  
  if (loginForm && submitBtn) {
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      // Deshabilitar botón para evitar múltiples envíos
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Verificando...';
      
      // Ejecutar reCAPTCHA v3
      grecaptcha.ready(function() {
        grecaptcha.execute(siteKey, {action: 'login'}).then(function(token) {
          // Agregar token al formulario
          document.getElementById('g-recaptcha-response').value = token;
          
          // Enviar formulario
          loginForm.submit();
        }).catch(function(error) {
          console.error('Error en reCAPTCHA:', error);
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          alert('Error en la verificación de seguridad. Intenta nuevamente.');
        });
      });
    });
  }
})();
</script>
{% endif %}
{% endblock extra_javascript %}

